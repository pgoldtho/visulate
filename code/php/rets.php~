<?php
    require_once dirname(__FILE__)."/classes/SmartyInit.class.php";
    require_once dirname(__FILE__)."/classes/database/rnt_search.class.php";
    require_once dirname(__FILE__)."/classes/UtlConvert.class.php";
    require_once dirname(__FILE__)."/classes/SQLExceptionMessage.class.php";
    require_once dirname(__FILE__)."/classes/api/phrets.php";
    
    require_once 'HTML/QuickForm/Renderer/ArraySmarty.php';
    require_once "HTML/QuickForm.php";
    $smarty = new SmartyInit('http');
    $dbReport = new LISTSearch($smarty->connection);

    $rets_login_url = "http://sef.rets.interealty.com/Login.asmx/Login";
    $rets_username = "sRuSanW";
    $rets_password = "fds83b43";

    $listings = $dbReport->getMlsNumbers(8);

    $rets = new phRETS;
    $rets->SetParam("offset_support", true);
    $rets->AddHeader("User-Agent", $rets_username);
/*
    $connect = $rets->Connect($rets_login_url, $rets_username, $rets_password, $rets_password);

    if (!($connect)){
      print_r($rets->Error());
      exit;
    }
*/
    foreach ($listings as $mlsNumber){
    print_r($mlsNumber);
    /*
      $photos = $rets->GetObject("Property", "Photo", $mlsNumber, "*", 0);
      foreach ($photos as $photo) {
         if ($photo['Success'] == true) {
                 file_put_contents("/home/pgoldtho/mlsImages/{$photo['Content-ID']}-{$photo['Object-ID']}.jpg", $photo['Data']);
         }
      }
      */
    }

//    $rets->Disconnect();
    

       $listings = $dbReport->getSalesFeed();

       $smarty->assign('listings', $listings);		
       $smarty->assign('photos', $photos);		
       $smarty->assign('feedTitle', "Investment Properties for Sale");
       $smarty->assign('feedDesc', "Commercial and Investment properties advertised for sale on the Visulate website");
       $smarty->display('visulate-listing-feed.tpl');


?>